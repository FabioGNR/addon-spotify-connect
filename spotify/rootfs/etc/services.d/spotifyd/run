#!/command/with-contenv bashio
# ==============================================================================
# Home Assistant Community Add-on: Spotify Connect
# Runs librespot
# ==============================================================================
declare -a options
declare bitrate
declare name

bashio::log.info 'Starting the Spotify daemon...'

# Bitrate
if bashio::config.exists 'bitrate'; then
  options+=(--bitrate $(bashio::config 'bitrate'))
fi

# Device name
name=$(bashio::config 'name')
options+=(--name "${name}")

# Cache
options+=(--cache "./librespot-cache")

# Initial volume
options+=(--initial-volume "70")

# Are we running in debug mode?
if bashio::debug; then
  options+=(--verbose)
fi

# Run librespot
exec librespot "${options[@]}"
